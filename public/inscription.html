<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inscription - Catho Speed Dating</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <!-- Ajoutez ceci dans le <head> -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="js/paytech.js"></script>
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="container">
        <nav class="navbar navbar-expand-lg">
          <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
              <img
                src="logo-catho-sd.png"
                alt="Catho Speed Dating"
                class="logo"
              />
              <span class="brand-name">Catho Speed Dating</span>
            </a>
          </div>
        </nav>
      </div>
    </header>

    <!-- Registration Section -->
    <section class="registration">
      <div class="container">
        <div class="registration-container">
          <div class="registration-form">
            <h2 class="section-title">Inscription</h2>
            <!-- Modifiez le formulaire comme ceci -->
            <form id="registrationForm">
              <div class="form-group">
                <label for="name">Nom complet</label>
                <input type="text" class="form-control" id="name" required />
              </div>
              <div class="form-group">
                <label for="email">Adresse email</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="form-group">
                <label for="phone">Téléphone</label>
                <input type="text" class="form-control" id="phone" required />
              </div>
              <div class="form-group">
                <label for="paroisse">Paroisse</label>
                <input
                  type="text"
                  class="form-control"
                  id="paroisse"
                  required
                />
              </div>
              <div class="form-group">
                <label for="age">Âge</label>
                <input type="number" class="form-control" id="age" required />
              </div>
              <div class="form-group">
                <label>Genre</label>
                <div class="gender-options">
                  <label
                    ><input type="radio" name="genre" value="male" required />
                    Homme</label
                  >
                  <label
                    ><input type="radio" name="genre" value="female" />
                    Femme</label
                  >
                </div>
              </div>
              <div class="form-group form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="terms"
                  required
                />
                <label class="form-check-label" for="terms">
                  J'accepte les conditions générales
                </label>
              </div>

              <button
                type="button"
                id="payerBtn"
                class="btn btn-primary btn-block"
              >
                <span id="submitText">Payer et s'inscrire</span>
                <div
                  id="spinner"
                  class="spinner-border spinner-border-sm d-none"
                  role="status"
                >
                  <span class="visually-hidden">Loading...</span>
                </div>
              </button>
            </form>
          </div>

          <div class="registration-summary">
            <div class="summary-card">
              <h3>Résumé de l'inscription</h3>
              <div class="summary-item">
                <span>Événement</span>
                <span>Speed Dating Catholique</span>
              </div>
              <div class="summary-item">
                <span>Date</span>
                <span>01 Août 2025</span>
              </div>
              <div class="summary-item">
                <span>Format</span>
                <span>En ligne (Google Meet)</span>
              </div>
              <div class="summary-item total">
                <span>Total</span>
                <span>2000 FCFA</span>
              </div>

              <div class="payment-methods">
                <h4>Méthodes de paiement</h4>
                <div class="methods">
                  <div class="method">
                    <i class="fab fa-cc-mastercard"></i>
                    <span>Carte bancaire</span>
                  </div>
                  <div class="method">
                    <i class="fas fa-mobile-alt"></i>
                    <span>Mobile money</span>
                  </div>
                  <div class="method">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Transfert bancaire</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="security-info">
              <i class="fas fa-lock"></i>
              <span>Paiement sécurisé SSL</span>
            </div>
          </div>
        </div>

        <div class="text-center mt-5">
          <a href="index.html" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Retour à l'accueil
          </a>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-brand">
            <img
              src="logo-catho-sd.png"
              alt="Catho Speed Dating"
              class="footer-logo"
            />
            <span>Catho Speed Dating</span>
          </div>
          <div class="footer-contact">
            <p>Dakar, Sénégal</p>
            <p>contact@catho-speed-dating.com</p>
          </div>
          <div class="footer-social">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-whatsapp"></i></a>
          </div>
        </div>
        <div class="footer-copyright">
          <p>&copy; 2025 Catho Speed Dating. Tous droits réservés.</p>
        </div>
      </div>
    </footer>
    <script>
      document
        .getElementById("payerBtn")
        .addEventListener("click", async function (e) {
          e.preventDefault();

          // Récupération des données du formulaire
          const formData = {
            nom: document.getElementById("name").value,
            email: document.getElementById("email").value,
            telephone: document.getElementById("phone").value,
            genre: document.querySelector('input[name="gender"]:checked').value,
            paroisse: document.getElementById("parish").value,
            age: document.getElementById("age").value,
            date_inscription: new Date().toLocaleString("fr-FR"),
          };

          // Validation simple
          if (!formData.nom || !formData.email || !formData.telephone) {
            alert("Veuillez remplir tous les champs obligatoires");
            return;
          }

          // Afficher le loader
          const btn = this;
          btn.disabled = true;
          btn.innerHTML =
            '<span class="spinner-border spinner-border-sm"></span> Traitement...';

          try {
            // Envoi des données au serveur
            const response = await fetch("/api/paiement", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();

            if (data.success && data.paymentUrl) {
              // Redirection vers PayTech
              window.location.href = data.paymentUrl;
            } else {
              throw new Error(data.message || "Erreur lors du paiement");
            }
          } catch (error) {
            console.error("Erreur:", error);
            alert("Erreur: " + error.message);
            btn.disabled = false;
            btn.innerHTML = "Payer et s'inscrire";
          }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
